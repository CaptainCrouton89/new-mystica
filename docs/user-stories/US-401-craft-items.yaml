title: Craft Materials onto Items
story_id: US-401
feature_id: F-04
template: ~/.claude/file-templates/init-project/user-stories/story-title.yaml
status: planned
last_updated: 2025-10-22

user_story:
  as_a: "Mobile RPG Player"
  i_want: "to craft materials onto my items via a dedicated crafting screen"
  so_that: "I can customize my equipment stats and appearance"

acceptance_criteria:
  - "[ ] Given main menu, when player taps 'Crafting', then open crafting screen with empty item and material slots"
  - "[ ] Given inventory, when player taps 'Craft' on item, then open crafting screen with item pre-filled in left slot"
  - "[ ] Given inventory, when player taps 'Craft' on material, then open crafting screen with material pre-filled in right slot"
  - "[ ] Given crafting screen, when player taps item slot, then show drawer with ALL items (rarity borders, equipped badges)"
  - "[ ] Given crafting screen, when player taps material slot, then show drawer with materials (style borders, quantities)"
  - "[ ] Given both slots filled, when displayed, then show stat preview (green=increase, red=decrease) with '?' for final image"
  - "[ ] Given stat preview, when player taps 'Craft', then consume material (quantity -1), apply to item, generate image (~20s)"
  - "[ ] Given craft complete, when showing results, then display craft count 'X players have crafted this combo'"
  - "[ ] Given item has 3 materials, when viewing material drawer, then grey out all materials with warning message"
  - "[ ] Given craft success, when complete, then show options: 'View Item', 'Return to Crafting', 'Return to Inventory'"

context:
  why: "Material crafting is the primary item customization system. Dedicated crafting screen provides focused UX for item + material combinations."
  related: "Links to F-09 (Inventory), F-04 (Materials), F-03 (Items), MainMenuView (Crafting button)"

technical_notes:
  apis: "POST /items/{item_id}/materials/apply with material_id and style_id. Returns enhanced item with new image URL and craft_count."
  data: "Materials are stackable (MaterialStacks). Items can have 0-3 materials applied (hard limit). Each combination generates unique image cached globally (ItemImageCache)."
  dependencies: "AI image generation (10-15s sync MVP0), material stat modifiers, crafting screen navigation, rarity/style border colors"
  ui: "Crafting screen: Left slot (items), Right slot (materials), stat preview between, 'Craft' confirmation button"
