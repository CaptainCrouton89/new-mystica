# Product Requirements Document
# Keep descriptions brief. Features link to feature-title.yaml specs.

status: draft
last_updated: 2025-10-20

overview:
  project_name: "New Mystica"
  summary: "A location-based mobile RPG where players explore real-world locations to discover enemies, collect items and pets, and engage in tactical combat. Players navigate using maps, craft powerful equipment, and build their collection through location-specific gameplay."
  problem_statement: "Existing location-based games lack deep RPG mechanics and meaningful item progression. Players want exploration-driven gameplay that rewards both movement and strategic decision-making with persistent character growth."

scope:
  in_scope:
    - Location-based enemy and item discovery via map integration
    - Tactical combat system with timing-based mechanics
    - Item and pet collection with rarity variants (standard/shiny)
    - Crafting system with generational progression (up to 3rd gen)
    - AI-generated items with stat distributions
    - Native iOS/macOS application
    - Backend API for data persistence and AI generation
  out_of_scope:
    - PvP combat (v1)
    - Social/multiplayer features (v1)
    - Trading system (v1)
    - Android support
    - Web frontend

summary:
  goal: "Create an engaging location-based RPG that combines exploration, collection, and strategic combat to drive daily active play sessions"
  primary_users:
    - "Mobile gamers (18-35) who enjoy RPG progression and collection mechanics"
    - "Location-based game players seeking deeper gameplay than existing titles"
    - "Collectors motivated by rare variants and crafting systems"
  key_problems_solved:
    - Provides meaningful RPG progression in location-based gameplay
    - Rewards both exploration (discovery) and strategy (combat/crafting)
    - Offers deep item customization through AI generation and crafting
    - Creates scarcity and value through location-specific items and shiny variants

features:
  - id: "F-01"
    description: "Geolocation & Map System - Google Maps integration for real-world navigation and location-based item/enemy discovery"
    priority: "critical"
    status: "planned"

  - id: "F-02"
    description: "Combat System - Timing-based combat with attack multiplier dial, stat calculations, and turn-based flow"
    priority: "critical"
    status: "planned"

  - id: "F-03"
    description: "Base Items & Equipment System - 6 equipment slots (weapon, helmet, armor, amulet, ring, pet) with normalized stat blocks and level progression"
    priority: "critical"
    status: "planned"

  - id: "F-04"
    description: "Materials System - Collectible materials that modify item stats (max 3 per item), with normal and shiny variants, replaceable for gold"
    priority: "critical"
    status: "planned"

  - id: "F-05"
    description: "Material Drop System - Enemies drop gold (always) and materials (60% chance), with 5% shiny rate and level-scaled rewards"
    priority: "critical"
    status: "planned"

  - id: "F-06"
    description: "Item Upgrade System - Spend gold to level up items, increasing stat values while maintaining normalized ratios"
    priority: "high"
    status: "planned"

  - id: "F-07"
    description: "User Authentication - Secure registration, login, and persistent user profiles"
    priority: "critical"
    status: "planned"

  - id: "F-08"
    description: "Design System - Consistent UI components (buttons, typography, colors) across all screens"
    priority: "high"
    status: "planned"

  - id: "F-09"
    description: "Inventory Management - View, organize, and equip collected items and pets"
    priority: "high"
    status: "planned"

  - id: "F-10"
    description: "Premium Items - Special single-location items available through premium currency"
    priority: "medium"
    status: "planned"

  - id: "F-11"
    description: "Pet Personality System - AI-powered dynamic pet personalities that generate contextual trash-talk and commentary during combat based on pet traits and battle events"
    priority: "high"
    status: "planned"

  - id: "F-12"
    description: "Enemy AI Personality System - AI-powered enemy personalities that generate contextual trash-talk during combat based on enemy type, game state, and player history (attempts, win/loss record, streaks)"
    priority: "high"
    status: "planned"

technical_constraints:
  platforms:
    - iOS 17+
    - macOS 14+ (secondary)
  backend:
    - Express.js 4.16.x
    - Supabase PostgreSQL for persistence
    - AI service for item generation
    - Google Maps API integration
  frontend:
    - SwiftUI for native UI
    - SwiftData for local caching
    - CoreLocation for geolocation
  deployment:
    - Railway for backend hosting
    - TestFlight for mobile distribution
  performance:
    - Map rendering must support smooth scrolling with 100+ location markers
    - Combat animations must run at 60fps
    - Item generation API response time < 2s

timeline:
  milestones:
    - phase: "Light MVP (3 days)"
      target: "2025-10-22"
      deliverables:
        - Basic map view with static locations
        - Simple combat prototype (dial mechanic)
        - Item data model with mock data
        - Basic UI design system

    - phase: "Full MVP (2 weeks)"
      target: "2025-11-05"
      deliverables:
        - Google Maps integration with real geolocation
        - Complete combat system with stats calculation
        - Items and pets system with equipping
        - AI item generation backend
        - Basic crafting (1st generation only)
        - User authentication and profiles

    - phase: "Finished Product (2 months)"
      target: "2026-01-05"
      deliverables:
        - Full crafting system (up to 3rd generation)
        - Shiny variants and rarity system
        - Premium items with single-location spawns
        - Polished UI/UX across all screens
        - Performance optimization
        - App Store submission
        - Analytics and monitoring

success_metrics:
  - metric: "Daily Active Users (DAU)"
    target: "1,000 DAU within first month post-launch"
  - metric: "Session Length"
    target: "Average 15+ minutes per session"
  - metric: "Retention (Day 7)"
    target: "40% D7 retention"
  - metric: "Material Application Rate"
    target: "70% of collected materials applied to items within 24 hours"
  - metric: "Location Visits"
    target: "Average 3+ unique locations visited per session"
  - metric: "Upgrade Engagement"
    target: "Average 2+ item upgrades per active user per day"

notes: |
  Core gameplay loop:
  1. Navigate to real-world location using map
  2. Discover location-specific enemy with level = player average item level
  3. Engage in timing-based combat (attack dial + defense dial)
  4. Defeat enemy → receive gold + material drops (60% chance, 5% shiny)
  5. Apply materials to base items (max 3 materials per item)
  6. Upgrade items with gold to increase level and stats
  7. Equip stronger items and repeat with harder enemies

  Key differentiators:
  - Tactical combat with skill-based timing (attack AND defense dials)
  - Material-based customization (stack up to 3 materials per item)
  - Normalized stat system (stats sum to 1.0, materials modify by ±0.1-0.3)
  - Dynamic enemy scaling (always appropriately challenging)
  - Shiny materials (+20% stat modifiers) for rare power spikes
  - Vanity level progression system (driven by item levels)

  Material System Details:
  - Base items have normalized stats: {atkPower, atkAccuracy, defPower, defAccuracy} sum to 1.0
  - Materials apply modifiers like +0.2 atkPower, -0.1 defSpeed (must sum to 0)
  - Max 3 materials per item (prevents excessive stacking)
  - Materials can be replaced for gold cost (old material destroyed)
  - Shiny materials: same modifiers but 1.2x effectiveness

  Combat Mechanics:
  - Attack dial: Timing determines damage multiplier (atkAccuracy = hit window size)
  - Defense dial: Timing determines damage reduction % (defAccuracy = block window size)
  - atkPower scales base damage, defPower scales reduction percentage
  - Enemy stats scale to player's average equipped item level

  Progression Systems:
  - Item levels: Spend gold to level up items (stats scale proportionally)
  - Vanity level: Increases based on total item levels across all items
  - Enemy difficulty: Scales dynamically to player's average item level
